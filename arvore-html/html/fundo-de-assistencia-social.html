<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhamento - AssistÃªncia Social</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        th { font-size: 0.8rem; vertical-align: middle !important; white-space: nowrap; }
        td { font-size: 0.75rem; vertical-align: middle !important; white-space: nowrap; }
        .table-responsive::-webkit-scrollbar { height: 8px; }
        .table-responsive::-webkit-scrollbar-thumb { background-color: #0d6efd; border-radius: 4px; }
        .table-responsive::-webkit-scrollbar-track { background-color: #f1f1f1; }
    </style>
</head>
<body class="bg-light font-monospace">

    <div class="container-fluid p-4">
        
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="text-primary fw-bold border-bottom border-warning border-3 pb-2 d-inline-block">
                    Fundo de AssistÃªncia Social - Por Fornecedor
                </h2>
                <a href="index.html" class="btn btn-outline-secondary btn-sm d-block mt-2" style="width: fit-content; margin: 0 auto;">&larr; Voltar para o Painel Geral</a>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-12">
                <div class="card shadow border-0">
                    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                        <h4 class="text-secondary fw-bold">Tabela de Gastos Detalhados</h4>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped table-hover mb-0">
                                <thead class="bg-primary text-white text-center">
                                    <tr>
                                        <th class="bg-primary text-white py-3">FORNECEDOR</th>
                                        <th class="bg-primary text-white">Jan</th>
                                        <th class="bg-primary text-white">Fev</th>
                                        <th class="bg-primary text-white">Mar</th>
                                        <th class="bg-primary text-white">Abr</th>
                                        <th class="bg-primary text-white">Mai</th>
                                        <th class="bg-primary text-white">Jun</th>
                                        <th class="bg-primary text-white">Jul</th>
                                        <th class="bg-primary text-white">Ago</th>
                                        <th class="bg-primary text-white">Set</th>
                                        <th class="bg-primary text-white">Out</th>
                                        <th class="bg-primary text-white">Nov</th>
                                        <th class="bg-primary text-white">Dez</th>
                                        <th class="bg-primary text-white fw-bold bg-warning text-dark">TOTAL</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaBody">
                                    </tbody>
                                <tfoot class="bg-primary text-white">
                                    <tr>
                                        <td class="text-end fw-bold py-2">TOTAL MENSAL:</td>
                                        <td id="total-0" class="text-end fw-bold small"></td>
                                        <td id="total-1" class="text-end fw-bold small"></td>
                                        <td id="total-2" class="text-end fw-bold small"></td>
                                        <td id="total-3" class="text-end fw-bold small"></td>
                                        <td id="total-4" class="text-end fw-bold small"></td>
                                        <td id="total-5" class="text-end fw-bold small"></td>
                                        <td id="total-6" class="text-end fw-bold small"></td>
                                        <td id="total-7" class="text-end fw-bold small"></td>
                                        <td id="total-8" class="text-end fw-bold small"></td>
                                        <td id="total-9" class="text-end fw-bold small"></td>
                                        <td id="total-10" class="text-end fw-bold small"></td>
                                        <td id="total-11" class="text-end fw-bold small"></td>
                                        <td id="total-geral" class="text-end fw-bold bg-warning text-dark"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-12 col-xl-11">
                <div class="card shadow border-0">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0 fw-bold text-center">ðŸ“Š Comparativo Anual por Fornecedor</h5>
                    </div>
                    <div class="card-body bg-white p-4">
                        <div style="height: 500px;">
                            <canvas id="graficoFornecedores"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3 text-end text-muted small">
            <p>Dados extraÃ­dos da planilha do Fundo de AssistÃªncia Social.</p>
        </div>

    </div>

    <script>
        // DADOS TRANSCRITOS DA IMAGEM DO FUNDO SOCIAL
        // Valores vazios/traÃ§os foram convertidos para 0
        const rawData = [
            { name: "4 RODAS", values: [0, 3098.31, 8394.47, 10328.59, 9924.51, 12039.95, 11783.47, 16806.22, 19237.39, 18857.13, 16451.82, 0] },
            { name: "CR TEXEIRA", values: [0, 5463.66, 11792.97, 0, 1421.88, 23264.98, 8386.28, 11196.41, 2522.84, 65716.89, 12078.19, 0] },
            { name: "CASA MEDEIROS", values: [0, 0, 0, 0, 0, 90000.63, 0, 0, 0, 0, 0, 0] },
            { name: "H.L.M DE SOUZA", values: [0, 0, 0, 0, 143.31, 558.38, 161.52, 0, 631.24, 0, 0, 0] },
            { name: "MARIA CASSIA", values: [0, 0, 1489.42, 3040.80, 808.30, 696.90, 117.00, 361.90, 368.50, 2765.50, 0, 0] },
            { name: "MERCEARIA SÃ“ MERENDAS", values: [2087.20, 838.20, 4353.34, 13215.69, 2465.20, 4899.71, 1225.04, 2304.38, 10240.64, 12145.05, 1681.55, 0] },
            { name: "NC GÃS", values: [480.00, 0, 0, 0, 0, 0, 0, 954.40, 0, 0, 0, 0] },
            { name: "PLATAFORMA EVENTOS", values: [0, 0, 0, 9961.60, 1848.00, 0, 0, 0, 6054.40, 119.30, 0, 0] },
            { name: "PRIMORDIAL", values: [0, 0, 1917.20, 18258.80, 1648.10, 343.20, 1411.80, 1570.80, 6006.00, 0, 0, 0] },
            { name: "VIACAO JEQUIE", values: [7314.75, 13209.30, 9361.33, 13474.97, 6696.11, 12950.34, 6500.00, 0, 0, 0, 0, 0] },
            { name: "PAPELARIA LIBERDADE", values: [4887.44, 4907.17, 7094.70, 2980.57, 6431.50, 7601.51, 4910.23, 2309.03, 6126.95, 5653.32, 2955.73, 0] }
        ];

        const formatBRL = (value) => {
            if (value === 0 || value === null) return "-";
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const labelsChart = [];
        const dataChart = [];
        const monthlyTotals = Array(12).fill(0);
        let grandTotal = 0;

        const tbody = document.getElementById('tabelaBody');

        rawData.forEach(item => {
            const totalFornecedor = item.values.reduce((acc, curr) => acc + curr, 0);
            
            if (totalFornecedor > 0) {
                labelsChart.push(item.name);
                dataChart.push(totalFornecedor);
                grandTotal += totalFornecedor;

                const tr = document.createElement('tr');
                let rowHtml = `<td class="fw-bold text-secondary text-start">${item.name}</td>`;
                item.values.forEach((val, index) => {
                    rowHtml += `<td class="text-end">${formatBRL(val)}</td>`;
                    monthlyTotals[index] += val;
                });
                rowHtml += `<td class="text-end fw-bold bg-light text-primary">${formatBRL(totalFornecedor)}</td>`;
                tr.innerHTML = rowHtml;
                tbody.appendChild(tr);
            }
        });

        monthlyTotals.forEach((val, index) => {
            document.getElementById(`total-${index}`).innerText = formatBRL(val);
        });
        document.getElementById('total-geral').innerText = formatBRL(grandTotal);

        // GRÃFICO
        const ctx = document.getElementById('graficoFornecedores').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labelsChart,
                datasets: [{
                    label: 'Total Pago (R$)',
                    data: dataChart,
                    // CORES IGUAIS AO FUNDO DE SAÃšDE
                    backgroundColor: '#0d6efd', // Azul Primary
                    borderColor: '#0a58ca',     // Azul Escuro
                    borderWidth: 1,
                    borderRadius: 4,
                    hoverBackgroundColor: '#ffc107', // Amarelo
                    hoverBorderColor: '#e0a800'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 50000, 
                            color: '#6c757d',
                            callback: function(value) {
                                if (value >= 1000) return (value/1000).toLocaleString('pt-BR') + ' mil';
                                return value;
                            }
                        },
                        grid: { color: '#e9ecef', borderDash: [5, 5] }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#495057', autoSkip: false, maxRotation: 55, minRotation: 55 }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return ' Total: ' + new Intl.NumberFormat('pt-BR', { 
                                    style: 'currency', currency: 'BRL' 
                                }).format(context.raw);
                            }
                        }
                    },
                    legend: { display: false }
                }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>