<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhamento - Fundo de Educa√ß√£o</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        th { font-size: 0.8rem; vertical-align: middle !important; white-space: nowrap; }
        td { font-size: 0.75rem; vertical-align: middle !important; white-space: nowrap; }
        /* Barra de rolagem personalizada */
        .table-responsive::-webkit-scrollbar { height: 8px; }
        .table-responsive::-webkit-scrollbar-thumb { background-color: #0d6efd; border-radius: 4px; }
        .table-responsive::-webkit-scrollbar-track { background-color: #f1f1f1; }
    </style>
</head>
<body class="bg-light font-monospace">

    <div class="container-fluid p-4">
        
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="text-primary fw-bold border-bottom border-warning border-3 pb-2 d-inline-block">
                    Fundo de Educa√ß√£o - Por Fornecedor
                </h2>
                <a href="index.html" class="btn btn-outline-secondary btn-sm d-block mt-2" style="width: fit-content; margin: 0 auto;">&larr; Voltar para o Painel Geral</a>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-12">
                <div class="card shadow border-0">
                    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                        <h4 class="text-secondary fw-bold">Tabela de Gastos Detalhados</h4>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped table-hover mb-0">
                                <thead class="bg-primary text-white text-center">
                                    <tr>
                                        <th class="bg-primary text-white py-3">FORNECEDOR</th>
                                        <th class="bg-primary text-white">Jan</th>
                                        <th class="bg-primary text-white">Fev</th>
                                        <th class="bg-primary text-white">Mar</th>
                                        <th class="bg-primary text-white">Abr</th>
                                        <th class="bg-primary text-white">Mai</th>
                                        <th class="bg-primary text-white">Jun</th>
                                        <th class="bg-primary text-white">Jul</th>
                                        <th class="bg-primary text-white">Ago</th>
                                        <th class="bg-primary text-white">Set</th>
                                        <th class="bg-primary text-white">Out</th>
                                        <th class="bg-primary text-white">Nov</th>
                                        <th class="bg-primary text-white">Dez</th>
                                        <th class="bg-primary text-white fw-bold bg-warning text-dark">TOTAL</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaBody">
                                    </tbody>
                                <tfoot class="bg-primary text-white">
                                    <tr>
                                        <td class="text-end fw-bold py-2">TOTAL MENSAL:</td>
                                        <td id="total-0" class="text-end fw-bold small"></td>
                                        <td id="total-1" class="text-end fw-bold small"></td>
                                        <td id="total-2" class="text-end fw-bold small"></td>
                                        <td id="total-3" class="text-end fw-bold small"></td>
                                        <td id="total-4" class="text-end fw-bold small"></td>
                                        <td id="total-5" class="text-end fw-bold small"></td>
                                        <td id="total-6" class="text-end fw-bold small"></td>
                                        <td id="total-7" class="text-end fw-bold small"></td>
                                        <td id="total-8" class="text-end fw-bold small"></td>
                                        <td id="total-9" class="text-end fw-bold small"></td>
                                        <td id="total-10" class="text-end fw-bold small"></td>
                                        <td id="total-11" class="text-end fw-bold small"></td>
                                        <td id="total-geral" class="text-end fw-bold bg-warning text-dark"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-12 col-xl-11">
                <div class="card shadow border-0">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0 fw-bold text-center">üìä Comparativo Anual por Fornecedor</h5>
                    </div>
                    <div class="card-body bg-white p-4">
                        <div style="height: 600px;">
                            <canvas id="graficoFornecedores"></canvas>
                        </div>
                    </div>
                    <div class="card-footer bg-light text-muted text-center small">
                        * Escala ajustada para visualizar grandes volumes (alguns fornecedores ultrapassam R$ 1 Milh√£o).
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3 text-end text-muted small">
            <p>Dados extra√≠dos do relat√≥rio financeiro do Fundo de Educa√ß√£o.</p>
        </div>

    </div>

    <script>
        // DADOS TRANSCRITOS DO FUNDO DE EDUCA√á√ÉO
        //
        const rawData = [
            { name: "4 RODAS", values: [0, 12406.95, 0, 100547.84, 0, 153696.39, 96944.72, 100326.06, 136127.08, 121613.63, 133684.12, 0] },
            { name: "CR TEXEIRA", values: [0, 55080.53, 0, 91164.39, 39143.59, 57698.64, 682297.30, 52023.89, 37515.32, 774472.50, 0, 0] },
            { name: "CASA MEDEIROS", values: [0, 0, 0, 0, 0, 48369.15, 12660.68, 10029.83, 3412.54, 0, 0, 0] },
            { name: "H.L.M DE SOUZA", values: [1417.60, 0, 3764.41, 0, 0, 0, 59345.00, 4186.50, 0, 0, 0, 0] },
            { name: "HDS", values: [358938.84, 285734.00, 557768.26, 0, 0, 0, 139983.00, 0, 0, 0, 0, 0] },
            { name: "MAIS SA√öDE", values: [0, 0, 1172.97, 14258.00, 0, 3759.00, 0, 0, 0, 0, 0, 0] },
            { name: "MARIA CASSIA", values: [0, 0, 0, 0, 0, 0, 10694.80, 15152.00, 0, 0, 0, 0] },
            { name: "MARTINS MEDEIROS", values: [0, 0, 0, 0, 0, 12226.26, 104386.79, 18795.01, 14132.66, 0, 21112.43, 0] },
            { name: "MERCEARIA S√ì MERENDAS", values: [7075.60, 0, 0, 8998.90, 0, 0, 0, 20457.10, 13651.12, 0, 0, 0] },
            { name: "NC G√ÅS", values: [0, 0, 0, 0, 0, 0, 2982.50, 0, 0, 0, 0, 0] },
            { name: "NR POLO", values: [0, 0, 0, 0, 9885.30, 0, 14830.92, 26580.85, 20769.30, 21405.80, 0, 0] },
            { name: "PLATAFORMA EVENTOS", values: [102320.00, 0, 0, 19008.00, 143968.00, 0, 0, 29920.00, 54111.20, 0, 0, 0] },
            { name: "PRIMORDIAL", values: [56231.00, 0, 70061.90, 0, 0, 0, 0, 14496.60, 127528.60, 0, 0, 0] },
            { name: "VIACAO JEQUIE", values: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3399.62, 0] },
            { name: "PAPELARIA LIBERDADE", values: [85757.45, 83531.23, 284738.54, 240753.90, 37614.33, 74033.25, 272340.85, 61994.44, 156611.20, 0, 192062.04, 0] }
        ];

        // Formatador
        const formatBRL = (value) => {
            if (value === 0 || value === null) return "-";
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        const labelsChart = [];
        const dataChart = [];
        const monthlyTotals = Array(12).fill(0);
        let grandTotal = 0;

        const tbody = document.getElementById('tabelaBody');

        rawData.forEach(item => {
            const totalFornecedor = item.values.reduce((acc, curr) => acc + curr, 0);
            
            if (totalFornecedor > 0) {
                labelsChart.push(item.name);
                dataChart.push(totalFornecedor);
                grandTotal += totalFornecedor;

                const tr = document.createElement('tr');
                let rowHtml = `<td class="fw-bold text-secondary text-start">${item.name}</td>`;
                
                item.values.forEach((val, index) => {
                    rowHtml += `<td class="text-end">${formatBRL(val)}</td>`;
                    monthlyTotals[index] += val;
                });

                rowHtml += `<td class="text-end fw-bold bg-light text-primary">${formatBRL(totalFornecedor)}</td>`;
                tr.innerHTML = rowHtml;
                tbody.appendChild(tr);
            }
        });

        // Preenche rodap√©
        monthlyTotals.forEach((val, index) => {
            document.getElementById(`total-${index}`).innerText = formatBRL(val);
        });
        document.getElementById('total-geral').innerText = formatBRL(grandTotal);

        // GR√ÅFICO
        const ctx = document.getElementById('graficoFornecedores').getContext('2d');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labelsChart,
                datasets: [{
                    label: 'Total Pago (R$)',
                    data: dataChart,
                    backgroundColor: '#0d6efd',
                    borderColor: '#0a58ca',
                    borderWidth: 1,
                    borderRadius: 4,
                    hoverBackgroundColor: '#ffc107',
                    hoverBorderColor: '#e0a800'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 50000, // Mantendo a consist√™ncia de 50k
                            color: '#6c757d',
                            callback: function(value) {
                                if (value >= 1000000) return (value/1000000).toLocaleString('pt-BR') + ' M';
                                if (value >= 1000) return (value/1000).toLocaleString('pt-BR') + ' mil';
                                return value;
                            }
                        },
                        grid: { color: '#e9ecef', borderDash: [5, 5] }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#495057', autoSkip: false, maxRotation: 55, minRotation: 55 }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return ' Total: ' + new Intl.NumberFormat('pt-BR', { 
                                    style: 'currency', currency: 'BRL' 
                                }).format(context.raw);
                            }
                        }
                    },
                    legend: { display: false }
                }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>